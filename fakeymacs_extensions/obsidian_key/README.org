#+STARTUP: showall indent

* Fakeymacs extension - obsidian_key -

** ■ Obsidian 用のキーの設定を行う

Obsidian 用のキーの設定を行う拡張機能です。

*** コンフィグレーションパラメータ

|--------------------------+-----------------------------------------------------------------------------------------------------|
| Configuration parameter  | Description                                                                                         |
|--------------------------+-----------------------------------------------------------------------------------------------------|
| fc.obsidian_language     | Obsidian に設定している表示言語を指定する（US: English、JP: 日本語）                                |
| fc.obsidian_target       | Obsidian 用のキーバインドを利用するアプリケーションソフトを指定する                                 |
| fc.obsidian_replace_key  | 置き換えするキーの組み合わせ（置き換え元のキー、置き換え先のキー）を指定する（複数指定可）          |
| fc.obsidian_command_dict | Obsidian の Command pallet で利用するコマンドを指定する（key: 英語コマンド、value: 日本語コマンド） |
|--------------------------+-----------------------------------------------------------------------------------------------------|

*** キーバインド

**** ● 「バッファ / ウィンドウ操作」のキー設定

|---------+------------------+-------------------+-------------|
| Keybind | Function         | Obsidian Command  | Description |
|---------+------------------+-------------------+-------------|
| M-k     | kill_buffer      | Close current tab |             |
| Ctl-x k | kill_buffer      | Close current tab |             |
| Ctl-x b | switch_to_buffer | Go to next tab    |             |
|---------+------------------+-------------------+-------------|

**** ● 「エディタ操作」のキー設定

|---------+----------------------+------------------------+----------------------------------------------------------------------------|
| Keybind | Function             | Obsidian Command       | Description                                                                |
|---------+----------------------+------------------------+----------------------------------------------------------------------------|
| Ctl-x 0 | delete_window        | Close this tab group   |                                                                            |
| Ctl-x 1 | delete_other_windows | Close all other tabs   |                                                                            |
| Ctl-x 2 | split_window_below   | Split down             |                                                                            |
| Ctl-x 3 | split_window_right   | Split right            |                                                                            |
| Ctl-x o | other_window         | Focus on tab group ... |                                                                            |
|---------+----------------------+------------------------+----------------------------------------------------------------------------|

※ Ctl-x 1 は、other tab groups が close する他、this tab group の other tabs も close となります。
Obsidian の機能による制約事項となります。

※ Ctl-x o は、tab group が２分割の状態のときのみ正常に動作します。３分割以上では正常に動作しません。
Obsidian のコマンドを選択する際に発生する制約事項となります。

***** fc.use_ctrl_digit_key_for_digit_argument が False（初期値） の場合

|---------+-----------------+---------------------------+------------------|
| Keybind | Function        | Obsidian Command          | Description      |
|---------+-----------------+---------------------------+------------------|
| C-0     | switch_focus(0) | Files: Show file explorer |                  |
| C-<n>   | switch_focus(n) | Go to tab #n              | n は 1 ～ 8 の値 |
| C-9     | switch_focus(9) | Go to last tab            |                  |
|---------+-----------------+---------------------------+------------------|

※ C-0 で Slidbar エリアに移動した後、別のファイルを選択することなく元の Editer
エリアに戻るためには、C-g を二回押下すれば良いようです。

***** fc.use_ctrl_digit_key_for_digit_argument が True の場合

|---------+-----------------+---------------------------+------------------|
| Keybind | Function        | Obsidian Command          | Description      |
|---------+-----------------+---------------------------+------------------|
| C-A-0   | switch_focus(0) | Files: Show file explorer |                  |
| C-A-<n> | switch_focus(n) | Go to tab #n              | n は 1 ～ 8 の値 |
| C-A-9   | switch_focus(9) | Go to last tab            |                  |
|---------+-----------------+---------------------------+------------------|

**** ● 「その他」のキー設定

|---------+--------------------------+----------------------+---------------------|
| Keybind | Function                 | Obsidian Command     | Description         |
|---------+--------------------------+----------------------+---------------------|
| M-x     | execute_extended_command | Open command palette |                     |
| M-;     | comment_dwim             | Toggle comment       |                     |
|---------+--------------------------+----------------------+---------------------|

※ Meta（M-）で Esc を利用したい場合には、fc.use_esc_as_meta 変数を True にしてください。
True にした場合に Esc を入力するには、Esc を二回押下してください。

**** ● キーの置き換え設定

|----------------------------------------+----------------------------------------+-------------|
| Original key                           | Replacement key                        | Description |
|----------------------------------------+----------------------------------------+-------------|
| fc.obsidian_replace_key[n][0] の設定値 | fc.obsidian_replace_key[n][1] の設定値 |             |
|----------------------------------------+----------------------------------------+-------------|

※ Fakeymacs では、C-q を前置するか、fc.side_of_ctrl_key で設定した側でない Ctrl キーを使う
方法でも Windows のショートカットキーを入力することが可能です。
このため、本設定は、利用頻度の高いキーの置き換えに使用するのが良いと思われます。

*** 関数（Functions）

**** ■ define_key_o

Obsidian 用キーマップにキーを定義する

***** Function

#+BEGIN_EXAMPLE
def define_key_o(keys, command):
#+END_EXAMPLE

***** Parameters

|---------------+----------------------------------------------------------|
| Parameter     | Description                                              |
|---------------+----------------------------------------------------------|
| keys          | 設定するキー（マルチストロークのキーはスペースで区切る） |
| command       | 実行するコマンド（関数）                                 |
|---------------+----------------------------------------------------------|

***** Returns

- 無し

**** ■ obsidianExecuteCommand

Obsidian のコマンドを実行する関数を返す

***** Function

#+BEGIN_EXAMPLE
def obsidianExecuteCommand(command, esc=False):
#+END_EXAMPLE

***** Parameters

|-----------+-----------------------------------------------------------------------------------------|
| Parameter | Description                                                                             |
|-----------+-----------------------------------------------------------------------------------------|
| command   | Obsidian の Command Palette で実行するコマンドの文字列（短縮形の場合も有り）            |
| esc       | コマンドが実行できない時にコマンドパレットの表示を消すための ESC を入力するかを指定する |
|-----------+-----------------------------------------------------------------------------------------|

***** Returns

- 引数で指定したコマンドを実行する関数

*** 留意事項

● 本フォルダにある _config_personal.py を config_personal.py というファイル名にすることで
機能拡張ファイルとして機能します。obsidian_key Extension の機能を拡張する際にご利用ください。

● fc.side_of_ctrl_key 変数で設定した側でない Ctrl キーを使う、C-q を前置することで、Obsidian 本来の
ショートカットキーを入力することもできます。

● obsidianExecuteCommand 関数内では日本語入力モードの切り替えを行っているのですが、Google
日本語入力を利用して入力モードのポップアップを表示する設定にしている場合、このポップアップが
何度も表示される症状が発生するようです。このため、ポップアップを非表示にする設定にしてご利用
ください。

- https://memotora.com/2014/10/05/google-ime-pop-up-setting/

● ブラウザで obsidian-remote を利用する場合、C-F4 がブラウザ側でキャッチされ、ブラウザの
タブを閉じようとしてしまいます。
このため、ブラウザで Ctl-x k を実行した場合には、コマンドパレットで Close current tab
を実行するようにし、obsidian-remote 側のタブを閉じるようにしています。
M-k は 従来どおり C-F4 を発行するのみの機能としていますので、ブラウザで obsidian-remote
を利用する場合には、M-k と Ctl-x k を使い分けるようにしてください。

● ブラウザで obsidian-remote を利用する場合、C-Tab がブラウザ側でキャッチされ、ブラウザの
タブを切り替えてしまいます。
このため、ブラウザで Ctl-x b を実行した場合には、コマンドパレットで Go to next tab
を実行するようにし、obsidian-remote 側のタブを切り替えるようにしています。
C-Tab は従来どおりブラウザで機能しますので、ブラウザで obsidian-remote を利用する場合には、
C-Tab と Ctl-x b を使い分けるようにしてください。

● Google Chrome を利用している場合、次のサイトに記載のある方法で obsidian-remote の画面の
ショートカットを「ウィンドウで開く」オプション付きで作成すると、先の２つの問題を回避する
ことができます。お試しください。

- https://zenn.dev/kato_k/articles/6301d35b3d8d3c#%E5%B0%8F%E6%8A%80

● Micorosoft Edge を利用している場合、次のサイトに記載のある方法で obsidian-remote の画面を
アプリ化すると、先の２つの問題を回避することができます。お試しください。

- https://kiritsume.com/microsoft-edge-install-as-an-app-feature/

● Canvas で Space + Drag する機能は Fakeymacs では正常に動作しません。Canvas をスクロールする
ためには、マウスの Scroll Wheel を利用してください。Shift キーと組み合わせることで、横スクロール
も可能となります。

● Quick Switcher: Open quick switcher（ショートカットキー：Ctrl+o）は、Fakeymacs のキーバインド
Ctl-x C-f で開くことができます。この後、ファイルを選択して Enter、C-Enter、C-A-Enter のいずれかの
キーで確定することにより、ファイルを指定の場所に開くことができます。

● 次の obsidian-remote という docker image を利用する場合には、Obsidian の言語設定を「English」にし、
fc.obsidian_language 変数の設定を "US" にしてご利用ください。
「日本語」で利用すると、コマンドの入力遅延により、obsidian の動作が不安定になります。

- https://hub.docker.com/r/linuxserver/obsidian
