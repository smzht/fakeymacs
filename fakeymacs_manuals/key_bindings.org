#+STARTUP: showall indent

* Fakeymacs key bindings manual

** キーバインド（Key bindings）

Fakeymacs で利用できるキーバインドは以下のとおりです。

*** ■ キーバインドの定義に利用可能な表記の説明

|------------------+---------------------------------------------------------------------------------------------|
| キーバインド表記 | 説明                                                                                        |
|------------------+---------------------------------------------------------------------------------------------|
| S-               | Shift キー（左右どちらでも）                                                                |
| C-               | Ctrl キー（fc.side_of_ctrl_key 変数で指定した側のキー）                                     |
| LC-              | 左 Ctrl キー                                                                                |
| RC-              | 右 Ctrl キー                                                                                |
| A-               | Alt キー（fc.side_of_alt_key 変数で指定した側のキー）                                       |
| LA-              | 左 Alt キー                                                                                 |
| RA-              | 右 Alt キー                                                                                 |
| W-               | Win キー（fc.side_of_win_key 変数で指定した側のキー）                                       |
| LW-              | 左 Win キー                                                                                 |
| RW-              | 右 Win キー                                                                                 |
| U<n>-            | User<n> キー（左 User<n> キー）                                                             |
| LU<n>-           | 左 User<n> キー                                                                             |
| RU<n>-           | 右 User<n> キー                                                                             |
| M-               | Alt キー と Esc、C-[ のプレフィックスキーを利用する３パターンを定義（Emacs の Meta と同様） |
| Ctl-x            | fc.ctl_x_prefix_key 変数で定義されているプレフィックスキーに置換え                          |
| (999)            | 仮想キーコード指定                                                                          |
|------------------+---------------------------------------------------------------------------------------------|

※ <n> は 0 から 3 の数字となります。User0 等のユーザモディファイアを利用する場合には、
keymap.defineModifier 関数でモディファイアキーを定義する必要があります。
keymap.defineModifier 関数の第２引数に指定するユーザモディファイアは、User0 のように L や R
を付けない場合は LUser0 として機能します。
右のユーザモディファイアを定義する場合は、RUser0 のように R を明示してください。

※ fc.use_esc_as_meta が False の場合、M（Meta）キーとして Esc は利用できません。

※ fc.use_ctrl_openbracket_as_meta が False の場合、M（Meta）キーとして C-[ は利用できません。

※ キーの記述方法は次のページを参照してください。

- http://crftwr.github.io/keyhac/doc/ja/

※ Fakeymacs では、特殊文字（+、: など）をアスキー文字で直接記述することもできます。この記法により、
日本語キーボードと英語キーボードのキー配置の違いを意識せずに記述することができます。

*** ■ Emacs 標準キーバインド

fc.emacs_target に登録されている、もしくは fc.not_emacs_target に登録されていないアプリケーション
ソフトで有効なキーバインドです。

**** ● quoted-insert キーの設定

|------------------+-------------------------------------+-------------|
| Keybind          | Function                            | Description |
|------------------+-------------------------------------+-------------|
| C-q <任意のキー> | self_insert_command("<任意のキー>") |             |
|------------------+-------------------------------------+-------------|

**** ● Esc キーの設定

|---------+----------------------------+-------------------------------------------------|
| Keybind | Function                   | Description                                     |
|---------+----------------------------+-------------------------------------------------|
| Esc     | self_insert_command("Esc") | fc.use_esc_as_meta が False の場合              |
| Esc Esc | self_insert_command("Esc") | fc.use_esc_as_meta が True の場合               |
| C-[     | self_insert_command("Esc") | fc.use_ctrl_openbracket_as_meta が False の場合 |
| C-[ C-[ | self_insert_command("Esc") | fc.use_ctrl_openbracket_as_meta が True の場合  |
|---------+----------------------------+-------------------------------------------------|

**** ● universal-argument キーの設定

|---------+--------------------+-------------|
| Keybind | Function           | Description |
|---------+--------------------+-------------|
| C-u     | universal_argument |             |
|---------+--------------------+-------------|

**** ● 数引数を指定するキーの設定

|---------+-------------------+---------------------------------------------------------|
| Keybind | Function          | Description                                             |
|---------+-------------------+---------------------------------------------------------|
| M-<n>   | digit_argument(n) | fc.use_alt_digit_key_for_f1_to_f12 が False の場合      |
| C-<n>   | digit_argument(n) | fc.use_ctrl_digit_key_for_digit_argument が True の場合 |
|---------+-------------------+---------------------------------------------------------|

**** ● 「IME の切り替え」のキー設定

|----------------------------------------+----------------------+------------------------|
| Keybind                                | Function             | Description            |
|----------------------------------------+----------------------+------------------------|
| fc.toggle_input_method_key の設定値    | toggle_input_method  | 初期値：C-\、C-o       |
| fc.set_input_method_key[n][0] の設定値 | disable_input_method | 初期値：<無変換>、<Ａ> |
| fc.set_input_method_key[n][1] の設定値 | enable_input_method  | 初期値：<変換>、<あ>   |
|----------------------------------------+----------------------+------------------------|
| fc.reconversion_key の設定値           | reconversion         | 初期値：C-,            |
|----------------------------------------+----------------------+------------------------|

※ <Ａ> キーと <あ> キーは、Microsoft の新しい日本語キーボードレイアウトに存在するキーとなります。
- https://docs.microsoft.com/ja-jp/windows-hardware/design/component-guidelines/keyboard-japan-ime

※ reconversion は IME の再変換を行う機能です。以下の仕様で動作します。
- 日本語入力確定後に C-, を押すと、「確定取り消し」として機能します。（Windows 10 May 2020 Update でリリースされた新しい Microsoft IME では、「確定取り消し」のキー設定が見つからないので「再変換」が機能するようにしています。）
- 文字列の選択（リージョンの設定）をして C-, または Space を押すと、「再変換」が機能します。
- 文字列が選択されているか（リージョンが設定されているか）は fakeymacs.forward_direction が設定されているかで判断しているため、マウスではなくキーボードによる選択が必要です。
- Microsoft IME の場合（新旧どちらの Microsoft IME でも）、文字列を選択せずに C-, を押すと、カーソル位置近くの文節で「再変換」が機能します。
- Emacs 日本語入力モードを有効にしている場合（デフォルトは有効）、「確定取り消し」や「再変換」の状態になると、Emacs 日本語入力モードが機能するようにしています。
- VSCode では、IME の再変換の機能がうまく動かないようです。

**** ● 「ファイル操作」のキー設定

|-----------+-------------+-------------|
| Keybind   | Function    | Description |
|-----------+-------------+-------------|
| Ctl-x C-f | find_file   |             |
| Ctl-x C-s | save_buffer |             |
| Ctl-x C-w | write_file  |             |
| Ctl-x d   | dired       |             |
|-----------+-------------+-------------|

**** ● 「カーソル移動」のキー設定

|---------------------------+-------------------------------+--------------------------------------|
| Keybind                   | Function                      | Description                          |
|---------------------------+-------------------------------+--------------------------------------|
| C-b                       | backward_char                 |                                      |
| C-f                       | forward_char                  |                                      |
| M-b                       | backward_word                 |                                      |
| M-f                       | forward_word                  |                                      |
| C-p                       | previous_line                 |                                      |
| C-n                       | next_line                     |                                      |
| C-a                       | move_beginning_of_line        |                                      |
| C-e                       | move_end_of_line              |                                      |
| M-<                       | beginning_of_buffer           |                                      |
| M->                       | end_of_buffer                 |                                      |
| M-g g                     | goto_line                     |                                      |
| M-g M-g                   | goto_line                     |                                      |
| C-l                       | recenter                      | 初期設定では、Sakura Editor のみ動作 |
| fc.scroll_key[0] の設定値 | scroll_up                     | 初期値：M-v                          |
| fc.scroll_key[1] の設定値 | scroll_down                   | 初期値：C-v                          |
|---------------------------+-------------------------------+--------------------------------------|
| C-S-b                     | mark + backward_char          |                                      |
| C-S-f                     | mark + forward_char           |                                      |
| M-S-b                     | mark + backward_word          |                                      |
| M-S-f                     | mark + forward_word           |                                      |
| C-S-p                     | mark + previous_line          |                                      |
| C-S-n                     | mark + next_line              |                                      |
| C-S-a                     | mark + move_beginning_of_line |                                      |
| C-S-e                     | mark + move_end_of_line       |                                      |
|---------------------------+-------------------------------+--------------------------------------|

**** ● 「カット / コピー / 削除 / アンドゥ」のキー設定

|-----------+----------------------+--------------------------------------------|
| Keybind   | Function             | Description                                |
|-----------+----------------------+--------------------------------------------|
| C-h       | delete_backward_char |                                            |
| C-d       | delete_char          |                                            |
| M-Delete  | backward_kill_word   |                                            |
| M-d       | kill_word            |                                            |
| C-k       | kill_line            |                                            |
| C-w       | kill_region          |                                            |
| C-x       | kill_region          | fc.ctl_x_prefix_key が C-x でない場合      |
| M-w       | kill_ring_save       |                                            |
| C-y       | yank                 |                                            |
| C-v       | yank                 | fc.scroll_key の設定等で上書きされない場合 |
| C-/       | undo                 |                                            |
| Ctl-x u   | undo                 |                                            |
| C-_       | undo                 |                                            |
| C-@       | set_mark_command     |                                            |
| C-Space   | set_mark_command     |                                            |
| Ctl-x h   | mark_whole_buffer    |                                            |
| Ctl-x C-p | mark_page            |                                            |
|-----------+----------------------+--------------------------------------------|

※ undo の機能は、C-g の押下により redo に切り替わります（以降、トグル動作）。

**** ● 「テキストの入れ替え」のキー設定

|---------+-----------------+-------------|
| Keybind | Function        | Description |
|---------+-----------------+-------------|
| C-t     | transpose_chars |             |
|---------+-----------------+-------------|

**** ● 「バッファ / ウィンドウ操作」のキー設定

|---------+------------------+--------------------------|
| Keybind | Function         | Description              |
|---------+------------------+--------------------------|
| M-k     | kill_buffer      | Fakeymacs オリジナル定義 |
| Ctl-x k | kill_buffer      |                          |
| Ctl-x b | switch_to_buffer |                          |
| Ctl-x o | other_window     |                          |
|---------+------------------+--------------------------|

**** ● 「文字列検索 / 置換」のキー設定

|---------+------------------+-------------|
| Keybind | Function         | Description |
|---------+------------------+-------------|
| C-r     | isearch_backward |             |
| C-s     | isearch_forward  |             |
| M-%     | query_replace    |             |
|---------+------------------+-------------|

**** ● 「キーボードマクロ」のキー設定

|---------+---------------------------+-------------|
| Keybind | Function                  | Description |
|---------+---------------------------+-------------|
| Ctl-x ( | kmacro_start_macro        |             |
| Ctl-x ) | kmacro_end_macro          |             |
| Ctl-x e | kmacro_end_and_call_macro |             |
|---------+---------------------------+-------------|

※ Keyhac のキーボードマクロは、Emacs のキーボードマクロと異なり、IME の切り替えも含む
キーの入力をそのまま記録し、そのまま再生します。このため、キーボードマクロの再生時に
その時の IME の状態に依存した動作とならないようにするため、キーボードマクロの記録と再生の
開始時に IME を強制的に OFF にするようにしています。

**** ● 「その他」のキー設定

|-----------+------------------------+---------------------------------------------------------|
| Keybind   | Function               | Description                                             |
|-----------+------------------------+---------------------------------------------------------|
| C-m       | newline                |                                                         |
| C-j       | newline_and_indent     |                                                         |
| C-o       | open_line              | fc.toggle_input_method_key の設定等で上書きされない場合 |
| C-i       | indent_for_tab_command | fc.use_ctrl_i_as_tab が True の場合                     |
| C-g       | keyboard_quit          |                                                         |
| Ctl-x C-c | kill_emacs             |                                                         |
| M-!       | shell_command          |                                                         |
|-----------+------------------------+---------------------------------------------------------|

*** ■ IME の切り替えのみを使うアプリケーションソフトのためのキーバインド

fc.not_emacs_target に登録されていて、かつ fc.ime_target に登録されているアプリケーションソフトで
有効なキーバインドです。

**** ● 「IME の切り替え」のキー設定

|----------------------------------------+----------------------+------------------------|
| Keybind                                | Function             | Description            |
|----------------------------------------+----------------------+------------------------|
| fc.toggle_input_method_key の設定値    | toggle_input_method  | 初期値：C-\、C-o       |
| fc.set_input_method_key[n][0] の設定値 | disable_input_method | 初期値：<無変換>、<Ａ> |
| fc.set_input_method_key[n][1] の設定値 | enable_input_method  | 初期値：<変換>、<あ>   |
|----------------------------------------+----------------------+------------------------|

*** ■ 「Emacs 日本語入力モード」のキーバインド

fc.use_emacs_ime_mode が True の場合に有効なキーバインドです。
IME が ON の時に文字（英数字か、スペースを除く特殊文字）を入力すると Emacs 日本語入力モード
が起動し、このキーバインドに移行します。

Emacs 日本語入力モードになると Emacs キーバインドとして利用できるキーが限定され、その他の
キーは Windows にそのまま渡されるようになるため、IME のショートカットキーが利用できるように
なります。

Emacs 日本語入力モードは、次の操作で終了します。
- Enter、C-m または C-g が押された場合
- <半角／全角> キー、A-` キーが押された場合
- BS、C-h 押下直後に fc.toggle_input_method_key 変数や fc.set_input_method_key 変数の disable で指定したキーが押された場合
  （間違って日本語入力をしてしまった時のキー操作を想定しての対策）

このモードでは IME のショートカットを置き換える機能もサポートしており、初期値では「ことえり」
のキーバインドを利用できるようにしています（fc.emacs_ime_mode_key 変数に設定されています）。

なお、「Emacs 日本語入力モード」の説明については、次のページの *<2020/04/23 更新>* の箇所にも記載
しています。参考としてください。

- https://w.atwiki.jp/ntemacs/pages/78.html

**** ● 「カーソル移動」のキー設定

|---------------------------+------------------------+-------------|
| Keybind                   | Function               | Description |
|---------------------------+------------------------+-------------|
| C-b                       | backward_char          |             |
| C-f                       | forward_char           |             |
| C-p                       | previous_line          |             |
| C-n                       | next_line              |             |
| C-a                       | move_beginning_of_line |             |
| C-e                       | move_end_of_line       |             |
| fc.scroll_key[0] の設定値 | scroll_up              | 初期値：A-v |
| fc.scroll_key[1] の設定値 | scroll_down            | 初期値：C-v |
|---------------------------+------------------------+-------------|

**** ● 「カット / コピー / 削除 / アンドゥ」のキー設定

|---------+----------------------+-------------|
| Keybind | Function             | Description |
|---------+----------------------+-------------|
| C-h     | delete_backward_char |             |
| C-d     | delete_char          |             |
|---------+----------------------+-------------|

**** ● 「その他」のキー設定

|------------+------------------+-------------|
| Keybind    | Function         | Description |
|------------+------------------+-------------|
| Enter, C-m | ei_newline       |             |
| C-g        | ei_keyboard_quit |             |
|------------+------------------+-------------|

※ C-g は日本語入力モードを終了させるためのキーですが、変換候補表示中に C-g を押下すると、
日本語入力が終了していな状態でも Emacs 日本語入力モードが終了してしまいます。
変換候補表示をキャンセルする場合には Esc を使うようにし、C-g と使い分けて利用するようにしてください。

**** ● 「IME のショートカットの置き換え」のキー設定

|--------------------------------------+--------------------------------------------------+--------------------------------------|
| Keybind                              | Function                                         | Description                          |
|--------------------------------------+--------------------------------------------------+--------------------------------------|
| fc.emacs_ime_mode_key[n][0] の設定値 | self_insert_command(fc.emacs_ime_mode_key[n][1]) | 初期設定：「ことえり」のキーバインド |
|--------------------------------------+--------------------------------------------------+--------------------------------------|

**** ● 「IME の切り替え」のキー設定

|----------------------------------------+--------------------------+------------------------|
| Keybind                                | Function                 | Description            |
|----------------------------------------+--------------------------+------------------------|
| fc.toggle_input_method_key の設定値    | ei_disable_input_method2 | 初期値：C-\、C-o       |
| fc.set_input_method_key[n][0] の設定値 | ei_disable_input_method2 | 初期値：<無変換>、<Ａ> |
| fc.set_input_method_key[n][1] の設定値 | ei_enable_input_method2  | 初期値：<変換>、<あ>   |
|----------------------------------------+--------------------------+------------------------|


*** ■ グローバルに利用できるキーバインド

すべてのアプリケーションソフトで共通して利用するキーバインドです。

**** ● 「キーマップの再設定」のキー設定

|-------------------------------+---------------+-------------------|
| Keybind                       | Function      | Description       |
|-------------------------------+---------------+-------------------|
| fc.update_keymap_key の設定値 | update_keymap | 初期値：A-S-Enter |
|-------------------------------+---------------+-------------------|

**** ● 「Emacs キーバインドの切り替え」のキー設定

|--------------------------------------+----------------------+-------------------|
| Keybind                              | Function             | Description       |
|--------------------------------------+----------------------+-------------------|
| fc.toggle_emacs_keybind_key の設定値 | toggle_emacs_keybind | 初期値：A-S-Space |
|--------------------------------------+----------------------+-------------------|

**** ● アプリケーションキーの設定

|-----------------------------+-----------------------------+--------------|
| Keybind                     | Function                    | Description  |
|-----------------------------+-----------------------------+--------------|
| fc.application_key の設定値 | self_insert_command("Apps") | 初期値：None |
|-----------------------------+-----------------------------+--------------|

**** ● ファンクションキーの設定（use_alt_digit_key_for_f1_to_f12 が True の場合）

|--------------------------+--------------------------------+-------------|
| Keybind                  | Function                       | Description |
|--------------------------+--------------------------------+-------------|
| A-<m>-1                  | self_insert_command("<m>-F1")  |             |
| A-<m>-2                  | self_insert_command("<m>-F2")  |             |
| A-<m>-3                  | self_insert_command("<m>-F3")  |             |
| A-<m>-4                  | self_insert_command("<m>-F4")  |             |
| A-<m>-5                  | self_insert_command("<m>-F5")  |             |
| A-<m>-6                  | self_insert_command("<m>-F6")  |             |
| A-<m>-7                  | self_insert_command("<m>-F7")  |             |
| A-<m>-8                  | self_insert_command("<m>-F8")  |             |
| A-<m>-9                  | self_insert_command("<m>-F9")  |             |
| A-<m>-0                  | self_insert_command("<m>-F10") |             |
| A-<m>-<上記の右隣のキー> | self_insert_command("<m>-F11") |             |
| A-<m>-<上記の右隣のキー> | self_insert_command("<m>-F12") |             |
|--------------------------+--------------------------------+-------------|

- <m> は 空、W、C、S の全ての組み合わせパターン

**** ● デスクトップに関するキー設定

***** ・ 表示しているウィンドウの中で、一番最近までフォーカスがあったウィンドウに移動

|------------------------------+--------------+-------------|
| Keybind                      | Function     | Description |
|------------------------------+--------------+-------------|
| fc.other_window_key の設定値 | other_window | 初期値：A-o |
|------------------------------+--------------+-------------|

***** ・ IME の「単語登録」プログラムの起動

|-------------------------------+-------------------------------------------------------------------------------------+-------------|
| Keybind                       | Function                                                                            | Description |
|-------------------------------+-------------------------------------------------------------------------------------+-------------|
| fc.word_register_key の設定値 | keymap.ShellExecuteCommand(None, fc.word_register_name, fc.word_register_param, "") | 初期値：C-] |
|-------------------------------+-------------------------------------------------------------------------------------+-------------|

**** ● クリップボードリスト起動キーの設定

|-------------------------------+------------------+-------------|
| Keybind                       | Function         | Description |
|-------------------------------+------------------+-------------|
| fc.clipboardList_key の設定値 | lw_clipboardList | 初期値：A-y |
|-------------------------------+------------------+-------------|

**** ● ランチャーリスト起動キーの設定

|-----------------------------+----------------+-------------|
| Keybind                     | Function       | Description |
|-----------------------------+----------------+-------------|
| fc.lancherList_key の設定値 | lw_lancherList | 初期値：A-l |
|-----------------------------+----------------+-------------|

※ 仮想デスクトップを利用している場合、利用中ではない仮想デスクトップ上に UWPアプリを
開いていると、そのアプリがランチャーリストの起動アプリ一覧に表示されない場合があります。
（表示中ではない仮想デスクトップ上に開いている UWPアプリが、バックグラウンドで起動して
いるアプリと区別がつかないため。）制約事項としてご了承ください。

*** ■ タスク切り替え画面のキーバインド

タスク切り替え画面が表示している時に利用するキーバインドです。
タスク切り替え画面は、A-Tab で表示します。

|---------+---------------------------------+-------------|
| Keybind | Function                        | Description |
|---------+---------------------------------+-------------|
| A-b     | self_insert_command("A-Left")   |             |
| A-f     | self_insert_command("A-Right")  |             |
| A-p     | self_insert_command("A-Up")     |             |
| A-n     | self_insert_command("A-Down")   |             |
| A-g     | self_insert_command("A-Esc")    |             |
|---------+---------------------------------+-------------|

*** ■ タスクビューのキーバインド

タスクビューが起動した時に利用するキーバインドです。
タスクビューは、W-Tab で表示します。

|---------+----------------------------+-------------|
| Keybind | Function                   | Description |
|---------+----------------------------+-------------|
| C-b     | backward_char              |             |
| C-f     | forward_char               |             |
| C-p     | previous_line              |             |
| C-n     | next_line                  |             |
| C-g     | self_insert_command("Esc") |             |
|---------+----------------------------+-------------|

*** ■ リストウィンドウのキーバインド

クリップボードリストやランチャーリストのリストウィンドウが起動した時に利用するキーバインドです。

**** ● Esc キーの設定

|---------+----------------------------+-------------|
| Keybind | Function                   | Description |
|---------+----------------------------+-------------|
| C-[     | self_insert_command("Esc") |             |
|---------+----------------------------+-------------|

**** ● 「カーソル移動」のキー設定

|---------------------------+---------------+-------------|
| Keybind                   | Function      | Description |
|---------------------------+---------------+-------------|
| C-b, A-b                  | backward_char |             |
| C-f, A-f                  | forward_char  |             |
| C-p, A-p                  | previous_line |             |
| C-n, A-n                  | next_line     |             |
| fc.scroll_key[0] の設定値 | scroll_up     | 初期値：A-v |
| fc.scroll_key[1] の設定値 | scroll_down   | 初期値：C-v |
|---------------------------+---------------+-------------|

**** ● 「カット / コピー / 削除 / アンドゥ」のキー設定

|----------+----------------------+-------------|
| Keybind  | Function             | Description |
|----------+----------------------+-------------|
| C-h, A-h | delete_backward_char |             |
| C-d, A-d | delete_char          |             |
|----------+----------------------+-------------|

**** ● 「文字列検索 / 置換」のキー設定

|----------+---------------------+-------------|
| Keybind  | Function            | Description |
|----------+---------------------+-------------|
| C-r, A-r | lw_isearch_backward |             |
| C-s, A-s | lw_isearch_forward  |             |
|----------+---------------------+-------------|

※ Keyhac に migemo 辞書を登録してあれば、検索文字を大文字で始めることで migemo 検索が
可能となります。

● 「その他」のキー設定

|------------------+--------------------------------+------------------------------------------------|
| Keybind          | Function                       | Description                                    |
|------------------+--------------------------------+------------------------------------------------|
| Enter, C-m, A-m  | self_insert_command("Enter")   | Emacs キーバインドを適用しているアプリの場合   |
| Enter, C-m, A-m  | self_insert_command("S-Enter") | Emacs キーバインドを適用していないアプリの場合 |
| S-Enter          | self_insert_command("S-Enter") |                                                |
| C-Enter, A-Enter | self_insert_command("C-Enter") |                                                |
| C-g, A-g         | lw_keyboard_quit               |                                                |
|------------------+--------------------------------+------------------------------------------------|

※ Keyhac に発行するキーの挙動は以下のとおりとなります。
|---------+----------------------------------------|
| Enter   | 選択したテキストの貼り付け             |
| S-Enter | 選択したテキストをクリップボードに格納 |
| C-Enter | 選択したテキストを引用記号付で貼り付け |
|---------+----------------------------------------|

Emacs キーバインドを適用しないアプリケーションソフトには文字の入出力の方式が特殊なものもあるため、
テキストの貼り付けはそのアプリケーションソフトのペースト操作で行うこととし、Enter 入力時に
クリップボードに格納する処理としています。
また、C-Enter の置き換えは、対応が複雑となるため行っておりません。
